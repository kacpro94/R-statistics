---
title: "Zadanie 1"
author: "Kacper Prorok"
date: "2024-04-01"
output: 
  html_document:
    theme: journal
    toc: yes
    toc_float:
      collapsed: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(tidyr)
```


Zadanie opierao si na por贸wnaniu mocy testu Shapiro-Wilka, testu Komogorowa i testu^2
(z hipotez g贸wn, 偶e cecha ma rozkad normalny) w przypadku, gdy dane pochodz z rozkadu
-Studenta lub innej klasy rozkad贸w symetrycznych.

# Symulacja


## Parametry symulacji 

```{r}
#ilo symulacji
N <- 1000
#stopnie swobody
dfs <- seq(1, 25, by = 2)
#dugo pr贸by
lengths <- c(10,50,150,500)

params <- expand.grid(df = dfs, length = lengths)


```


## Kod

```{r}
shapiro<-function(df,n,K){
  
  mean(sapply(1:K,function(i) shapiro.test(rt(n,df))$p.value<0.05))
  
}



wyniki<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki[i]<-shapiro(params[i,1],params[i,2],1000)
}



params<-cbind(params,"shapiro"=wyniki)


```


```{r}


kolomogorow<-function(df,n,K){
  
  mean(sapply(1:K,function(i) ks.test(rt(n,df),pnorm)$p.value<0.05))
  
}

wyniki<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki[i]<-kolomogorow(params[i,1],params[i,2],1000)
}



params<-cbind(params,"kolomogrow"=wyniki)


```


```{r message=FALSE, warning=FALSE}


chi2<-function(df,n){
  dane<-rt(n,df)
  k<-numeric(0)
  klasy<-5
  for (x in 0:klasy)
  {
    x<-qnorm(x/klasy, mean = mean(dane), sd = sd(dane))
    k<-c(k,x)
  }
  df<-data.frame("dolna_gr"=k[1:klasy], "gorna_gr"=k[2:(klasy+1)])
  head(df,5)
  n<-numeric(0)
  for(i in 1:klasy)
  {
    n<-c(n,length(dane[dane>k[i] & dane<k[i+1]])) 
  }
  df<-data.frame("dolna_gr"=k[1:klasy], "gorna_gr"=k[2:(klasy+1)],"n"= n[1:klasy])
  return(df$n)
  
}



chi2moc<-function(df,n,K){
  
  mean(sapply(1:K,function(i)  chisq.test(chi2(df,n))$p.value<0.05))
}


# w funkcji chi2 daje 500 symulacji, poniewa偶 1000 za dugo trwao!

wyniki<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki[i]<-chi2moc(params[i,1],params[i,2],500)
}



params<-cbind(params,"chi2"=wyniki)


dane<-params%>%
  pivot_longer(cols=c("shapiro","kolomogrow","chi2"),names_to="Test",values_to="Moc")

```

## Wykres

```{r}

ggplot(dane,aes(x=df,y=Moc,color = factor(Test)))+
  geom_line()+
  facet_wrap(~ length, nrow = 2)+
  labs(color="Test")
  
    

```

*Na osi X znajduj si stopnie swobody, na osi Y moc testu. Nad wykresami znajduje si liczebno pr贸bki.*


# Wnioski

- Wraz ze wzrostem liczby danych we wszystkich testach zwikszya si moc, ale najbardziej w tecie Shapiro-Wilka.

- Wraz ze wzrostrem liczby stopni swobody rozkadu t-studenta wszystkie testy stopniowo maj mniejsz moc. Jest to spowodowane tym, 偶e test t-studenta coraz bardziej przypomina rozkad normalny, wic ronie prawdopodobiestwo 偶e test mo偶e si pomyli.

- Najlepiej z trzech test贸w poradzi sobie test Shapiro-Wilka (szczeg贸lnie przy du偶ej pr贸bce). Przy maych pr贸bkach moce test贸w wyszy bardzo zbli偶one.