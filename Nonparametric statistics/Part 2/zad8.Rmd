---
title: "Zadanie 8"
author: "Kacper Prorok"
date: "2024-04-21"
output: 
  html_document:
    theme: journal
    toc: yes
    toc_float:
      collapsed: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(tidyr)
```


Za pomocƒÖ odpowiednich symulacji zbadaƒá odsetek odrzuce≈Ñ prawdziwej hipotezy g≈Ç√≥wnej (tzn. b≈ÇƒÖd
I rodzaju) w te≈õcie istotno≈õci wsp√≥≈Çczynnika korelacji w przypadku, gdy dane pochodzƒÖ z rozk≈Çadu ùúí2 irozk≈Çadu ‚àí1 ‚àô ùúí2 (tzn. generujemy dane z rozk≈Çadu ùúí2 i mno≈ºymy je przez -1).


Przeprowadzƒô symulacje w 2 wariantach - gdy stopnie swobody dw√≥ch rozk≈Çad√≥w sƒÖ r√≥≈ºne i gdy stopnie swobody rozk≈Çad√≥w sƒÖ takie same

# Symulacja 1

Stopnie swobody dw√≥ch rozk≈Çad√≥w sƒÖ r√≥≈ºne

## Parametry symulacji

```{r}
#ilo≈õƒá symulacji
N <- 500
#stopnie swobody rozk≈Çadu 1
df1 <- seq(3,31,by=1)
#d≈Çugo≈õƒá pr√≥by
lengths <- c(5,25,100,500)
#stopnie swobody rozk≈Çadu 2
df2 <- seq(3,31,by=1)

params <- expand.grid(df1 = df1, df2=df2, length = lengths)


```


## Kod

```{r}
Spearman<-function(n,df1,df2,K){
  mean(sapply(1:K, function(i) cor.test(rchisq(n,df1),-1*rchisq(n,df2),method="spearman")$p.value<0.05))
} 

Pearson<-function(n,df1,df2,K){
 mean(sapply(1:K, function(i) cor.test(rchisq(n,df1),-1*rchisq(n,df2))$p.value<0.05))
}

set.seed(420)

wyniki<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki[i]<-Spearman(params[i,3],params[i,1],params[i,2],500)
}


wyniki1<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki1[i]<-Pearson(params[i,3],params[i,1],params[i,2],500)
}

params<-cbind(params,"Spearman"=wyniki)
params<-cbind(params,"Pearson"=wyniki1)

params<-params%>%
  pivot_longer(cols=c("Spearman","Pearson"),names_to="Test",values_to = "Odsetek")
```

## Wykres 1

```{r}
wykres<-params%>%
  filter(Test=="Spearman")%>%
  ggplot()+
  geom_point(aes(x=df1,y=df2,color = Odsetek))+
  facet_wrap(~length)+
  labs(title = "Odsetek odrzuce≈Ñ prawdziwej H0 - test Spearman",
       x="stopnie swobody 1 rozk≈Çadu",
       y="stopnie swobody 2 rozk≈Çadu",
       color="Odsetek odrzuce≈Ñ")
wykres



```

*liczba danych znajduje siƒô nad wykresami*

## Wykres 2

```{r}
wykres<-params%>%
  filter(Test=="Pearson")%>%
  ggplot()+
  geom_point(aes(x=df1,y=df2,color = Odsetek))+
  facet_wrap(~length)+
  labs(title = "Odsetek odrzuce≈Ñ prawdziwej H0 - test Pearson",
       x="stopnie swobody 1 rozk≈Çadu",
       y="stopnie swobody 2 rozk≈Çadu",
       color="Odsetek odrzuce≈Ñ")
wykres
```

*liczba danych znajduje siƒô nad wykresami*

## Wnioski

- Odsetek odrzuce≈Ñ w obu testach jest bliski 0.05, czyli poziomu istotno≈õci

- Odsetek odrzuce≈Ñ hipotezy h0 nie zale≈ºy od stopni swobody rozk≈Çad√≥w

- Odsetek odrzuce≈Ñ hipotezy h0 nie zale≈ºy od liczby danych, jedynie widzimy ≈ºe dla *ma≈Çej liczno≈õci danych test istotno≈õci korelacji Spearmana ma wszƒôdzie ni≈ºszy odsetek odrzuce≈Ñ hipotezy H0* - oscyluje on w okolicy 0.02. 


# Symulacja 2

Rozk≈Çady majƒÖ tyle samo stopni swobody.

## Parametry symulacji

```{r}
#ilo≈õƒá symulacji
N <- 500
#warto≈õci oczekiwane
df1 <- seq(3,30,by=1)
#d≈Çugo≈õƒá pr√≥by
lengths <- c(5,25,100,500)
params <- expand.grid(df1 = df1, length = lengths)


```


## Kod

```{r}
Spearman<-function(n,df1,K){
  mean(sapply(1:K, function(i) cor.test(rchisq(n,df1),-1*rchisq(n,df1),method="spearman")$p.value<0.05))
} 

Pearson<-function(n,df1,K){
 mean(sapply(1:K, function(i) cor.test(rchisq(n,df1),-1*rchisq(n,df1))$p.value<0.05))
}

set.seed(420)

wyniki<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki[i]<-Spearman(params[i,1],params[i,2],500)
}


wyniki1<-c()
dlugosc<-c(1:nrow(params))
for(i in dlugosc){
  wyniki1[i]<-Pearson(params[i,1],params[i,2],500)
}

params<-cbind(params,"Spearman"=wyniki)
params<-cbind(params,"Pearson"=wyniki1)

params<-params%>%
  pivot_longer(cols=c("Spearman","Pearson"),names_to="Test",values_to = "Odsetek")


```


## Wykres 

```{r}
wykres<-params%>%
  ggplot()+
  geom_point(aes(x=df1,y=Odsetek,color = Test))+
  facet_wrap(~length)+
  labs(title = "Odsetek odrzuce≈Ñ prawdziwej H0",
       x="stopnie swobody",
       y="Odsetek odrzuce≈Ñ",
       color="Test")
wykres
```

*liczba danych znajduje siƒô nad wykresami*

## Wnioski

- Odsetek odrzuce≈Ñ hipotezy H0 oscyluje w okolicy 0.05 w przypadku obydw√≥ch test√≥w

- Ponownie odsetek odrzuce≈Ñ nie zale≈ºy od stopni swobody ani od liczby danych

- *Test istotno≈õci korelacji Spearmana w przypadku ma≈Çych stopni swobody (do oko≈Ço 6) wykazuje (w ka≈ºdej liczno≈õci) ni≈ºszy odsetek odrzuce≈Ñ hipotezy H0*


